services:
  mc:
    image: itzg/minecraft-server:latest
    pull_policy: daily
    tty: true
    stdin_open: true
    environment:
      EULA: "TRUE"
      MEMORY: "6G"
    volumes:
      # attach the relative directory 'data' to the container's /data path
      - ./data:/data
    network_mode: "service:tailscale"
    depends_on:
      - tailscale

  tailscale:
    container_name: tailscale
    hostname: tailscale-mc
    image: tailscale/tailscale:stable
    volumes:
      - ./tailscale:/var/lib # State data will be stored in this directory
      - /dev/net/tun:/dev/net/tun # Required for tailscale to work
    cap_add: # Required for tailscale to work
      - net_admin
      - sys_module
    command: tailscaled
    privileged: true
    restart: unless-stopped
